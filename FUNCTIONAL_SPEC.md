# 📋 功能说明书 (Functional Specification)

## 1. 核心架构与业务流程 (Core Architecture & Flow)

### 1.1 系统架构图 (Architecture Diagram)

```text
     [医生/前台/患者]
           |
       (Web/H5)
           |
           v
       [应用容器]
           |
       (Context)
           |
           v
     [区域数据中心] <-----------------------+----------------------+
          ^                                 |                      |
          | (更新)                          |                      |
          |                           +-----+-----+          +-----+-----+
    +-----+-----+                     |           |          |           |
    | 核心模块   | --(分析结果)--> [临床病历] --(触发)--> [库存逻辑] --(扣减库存)--> [库存数据中心] --(更新)--> [库存视图]
    | (Web)     |                     |           |
    +-----+-----+                     | (触发)    |
          |                           v           |
          |                      [计费逻辑]       |
          |                           |           |
          | (生成账单)                |           |
          +---------------------------+           |
                                                  |
    +-----+-----+                                 |
    | 移动端 H5  | --(同步)-----------------------+
    +-----+-----+
          |
    (更新) |
          v
     [财务视图]
```

### 1.2 关键业务闭环 (Key Business Loops)

1.  **AI 辅助诊疗闭环**：
    - **输入**：医生上传 X 光片/全景片。
    - **处理**：AI 引擎 (模拟) 分析影像，识别龋齿、根尖周炎等病灶。
    - **输出**：生成结构化诊断报告，自动包含置信度 (Confidence Score)。
    - **落地**：医生一键接受 (`Accept & Report`)，转化为电子病历 (EMR) 记录。

2.  **耗材与计费自动化闭环**：
    - **触发点**：医生在 EMR 中记录特定治疗项目（如 "种植牙手术"）。
    - **耗材动作**：系统自动调用 `InventoryContext`，扣减对应套装（种植体 x1, 骨盖 x1, 缝合线 x1）。
    - **计费动作**：系统自动根据 `PriceList` 生成待支付账单 (`Unpaid Invoice`)。
    - **结果**：库存实时更新，财务流水自动生成，杜绝漏费。

---

## 2. 模块详细说明 (Module Details)

### 2.1 患者管理 (Patient Management)

- **360 视图**：整合基本信息、过敏史、家庭关系。
- **电子病历 (EMR)**：支持 SOAP 格式记录，关联牙位图。
- **影像中心 (Imaging)**：支持 JPG/DICOM (模拟) 查看，AI 标注工具。
- **3D 扫描中心 (3D Scan)**：集成 Three.js/R3F，支持 STL/OBJ 格式预览，实时测量牙尖高度、宽度，支持 CAD 边缘线修改审查。
- **治疗计划 (Treatment Plan)**：可视化展示分阶段治疗方案。

### 2.2 预约管理 (Start Center)

- **日历视图**：支持日/周/月切换，拖拽调整时间。
- **状态追踪**：`Pending` -> `Confirmed` -> `Checked-in` -> `Completed` -> `No-show`。
- **资源调度**：关联医生与椅位资源。

### 2.3 运营与财务 (Operations & Finance)

- **库存管理**：低库存预警，入库/出库记录，效期管理。
- **财务报表**：实收/应收统计，支付方式分析 (WeChat/AliPay/Cash)。
- **加工件与生产 (Lab Production)**：
  - **看板模式**：技工专用的任务状态看板。
  - **工艺追踪**：支持扫描入库、CAD设计、CAM切削、烧结、QC抛光、发货同步。
  - **医技沟通**：医生可在 3D 预览中直接标注修改意见并实时传回生产车间。

### 2.4 移动端 (Mobile H5)

- **患者端**：
  - **首页**：查看预约，接收诊所通知。
  - **病历夹**：查看历史诊断、处方、影像。
  - **医患沟通**：实时消息聊天。
- **医生端**：
  - **仪表盘**：查看今日患者列表。
  - **移动审方**：查看影像并快速回复。

---

## 3. 技术栈 (Technical Stack)

- **前端框架**：React + Vite
- **路由管理**：React Router v6
- **状态管理**：Context API (RegionContext, InventoryContext)
- **UI 组件库**：TailwindCSS + Lucide Icons + Recharts
- **3D 渲染引擎**：Three.js + React Three Fiber (用于 3D 模型交互)
- **动画引擎**：Framer Motion (用于 AI 扫描、页面转场)
- **状态同步**：React Context + BroadcastChannel API (模拟多端同步)
